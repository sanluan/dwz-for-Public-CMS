/*!
 * PhotoClip - 一款手势驱动的裁图插件
 * @version v3.4.8
 * @author baijunjie
 * @license MIT
 * 
 * git - https://github.com/baijunjie/PhotoClip.js.git
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("hammerjs"),require("iscroll/build/iscroll-zoom"),require("lrz")):"function"==typeof define&&define.amd?define(["hammerjs","iscroll","lrz"],e):"object"==typeof exports?exports.PhotoClip=e(require("hammerjs"),require("iscroll/build/iscroll-zoom"),require("lrz")):t.PhotoClip=e(t.Hammer,t.IScroll,t.lrz)}(this,function(t,e,i){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(o,r,function(e){return t[e]}.bind(null,r));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t){return"[object Array]"===Object.prototype.toString.call(t)}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t.exports=function(t){return"object"===e(t)}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t){return"number"==typeof t}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i={};t.exports=function(t,o,r){"object"!==e(t)&&(t=[]),void 0===t.length&&(t=[t]);for(var a,n=[],s=[],l=0;a=t[l++];)for(;a instanceof HTMLElement;){var u=a.nodeName;if(!a.getClientRects().length){n.push(a),s.push(a.style.display);var h=i[u];if(!h){var c=document.createElement(u);document.body.appendChild(c),h=window.getComputedStyle(c).display,c.parentNode.removeChild(c),"none"===h&&(h="block"),i[u]=h}a.style.display=h}if("BODY"===u)break;a=a.parentNode}"function"==typeof o&&o.call(r||this);for(var f=n.length;f--;)n.pop().style.display=s.pop()}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[e,i(5),i(6),i(7),i(8),i(9),i(10),i(2),i(0),i(14),i(15),i(16),i(3),i(17),i(18),i(19),i(20),i(22)],void 0===(a="function"==typeof(o=function(i,o,r,a,n,s,l,u,h,c,f,p,_,d,y,m,g,v){"use strict";function L(t){return t&&t.__esModule?t:{default:t}}function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0,o=L(o),r=L(r),a=L(a),n=L(n),s=L(s),l=L(l),u=L(u),h=L(h),c=L(c),f=L(f),p=L(p),_=L(_),d=L(d),y=L(y),m=L(m),g=L(g),v=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};o.get||o.set?Object.defineProperty(e,i,o):e[i]=t[i]}return e.default=t,e}(v);var x=!!navigator.userAgent.match(/mobile/i),z=!!navigator.userAgent.match(/android/i),$=(0,d.default)("transition"),k=(0,d.default)("transform"),w=function(){},P={size:[100,100],adaptive:"",outputSize:[0,0],outputType:"jpg",outputQuality:.8,maxZoom:1,rotateFree:!z,view:"",file:"",ok:"",img:"",loadStart:w,loadComplete:w,loadError:w,done:w,fail:w,lrzOption:{width:z?1e3:void 0,height:z?1e3:void 0,quality:.7},style:{maskColor:"rgba(0,0,0,.5)",maskBorder:"2px dashed #ddd",jpgFillColor:"#fff"},errorMsg:{noSupport:"您的浏览器版本过于陈旧，无法支持裁图功能，请更换新的浏览器！",imgError:"不支持该图片格式，请选择常规格式的图片文件！",imgHandleError:"图片处理失败！请更换其它图片尝试。",imgLoadError:"图片读取失败！请更换其它图片尝试。",noImg:"没有可裁剪的图片！",clipError:"截图失败！当前图片源文件可能存在跨域问题，请确保图片与应用同源。如果您是在本地环境下执行本程序，请更换至服务器环境。"}},M=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(e=(0,g.default)(e))&&e.length&&(this._$container=e[0],this._options=(0,l.default)(!0,{},P,i),void 0===k&&this._options.errorMsg.noSupport&&alert(this._options.errorMsg.noSupport),this._init())}var e,i,d;return e=t,(i=[{key:"_init",value:function(){var t=this,e=this._options;(0,u.default)(e.size)?e.size=[e.size,e.size]:(0,h.default)(e.size)?((!(0,u.default)(e.size[0])||e.size[0]<=0)&&(e.size[0]=P.size[0]),(!(0,u.default)(e.size[1])||e.size[1]<=0)&&(e.size[1]=P.size[1])):e.size=(0,l.default)({},P.size),(0,u.default)(e.outputSize)?e.outputSize=[e.outputSize,0]:(0,h.default)(e.outputSize)?((!(0,u.default)(e.outputSize[0])||e.outputSize[0]<0)&&(e.outputSize[0]=P.outputSize[0]),(!(0,u.default)(e.outputSize[1])||e.outputSize[1]<0)&&(e.outputSize[1]=P.outputSize[1])):e.outputSize=(0,l.default)({},P.outputSize),"jpg"===e.outputType?e.outputType="image/jpeg":e.outputType="image/png",(0,h.default)(e.adaptive)&&(this._widthIsPercent=!(!e.adaptive[0]||!(0,c.default)(e.adaptive[0]))&&e.adaptive[0],this._heightIsPercent=!(!e.adaptive[1]||!(0,c.default)(e.adaptive[1]))&&e.adaptive[1]),this._outputWidth=e.outputSize[0],this._outputHeight=e.outputSize[1],this._canvas=document.createElement("canvas"),this._iScroll=null,this._hammerManager=null,this._clipWidth=0,this._clipHeight=0,this._clipSizeRatio=1,this._$img=null,this._imgLoaded=!1,this._containerWidth=0,this._containerHeight=0,this._viewList=null,this._fileList=null,this._okList=null,this._$mask=null,this._$mask_left=null,this._$mask_right=null,this._$mask_right=null,this._$mask_bottom=null,this._$clip_frame=null,this._$clipLayer=null,this._$moveLayer=null,this._$rotateLayer=null,this._moveLayerWidth=0,this._moveLayerHeight=0,this._moveLayerPaddingLeft=0,this._moveLayerPaddingTop=0,this._atRotation=!1,this._rotateLayerWidth=0,this._rotateLayerHeight=0,this._rotateLayerX=0,this._rotateLayerY=0,this._rotateLayerOriginX=0,this._rotateLayerOriginY=0,this._curAngle=0,(0,n.default)(this,"_resetScroll","_rotateCW90","_fileOnChangeHandle","_clipImg","_resize","size","load","clear","rotate","scale","clip","destroy"),this._initElements(),this._initScroll(),this._initRotationEvent(),this._initFile(),this._resize(),window.addEventListener("resize",this._resize),(this._okList=(0,g.default)(e.ok))&&this._okList.forEach(function(e){e.addEventListener("click",t._clipImg)}),this._options.img&&this._lrzHandle(this._options.img)}},{key:"_initElements",value:function(){var t=this._$container,e=t.style,i={};i["user-select"]=e["user-select"],i.overflow=e.overflow,i.position=e.position,this._containerOriginStyle=i,(0,y.default)(t,{"user-select":"none",overflow:"hidden"}),"static"===(0,y.default)(t,"position")&&(0,y.default)(t,"position","relative"),this._$clipLayer=(0,f.default)(t,"photo-clip-layer",{position:"absolute",left:"50%",top:"50%"}),this._$moveLayer=(0,f.default)(this._$clipLayer,"photo-clip-move-layer"),this._$rotateLayer=(0,f.default)(this._$moveLayer,"photo-clip-rotate-layer");var o=this._$mask=(0,f.default)(t,"photo-clip-mask",{position:"absolute",left:0,top:0,width:"100%",height:"100%","pointer-events":"none"}),r=this._options,a=r.style.maskColor,n=r.style.maskBorder;if(this._$mask_left=(0,f.default)(o,"photo-clip-mask-left",{position:"absolute",left:0,right:"50%",top:"50%",bottom:"50%",width:"auto","background-color":a}),this._$mask_right=(0,f.default)(o,"photo-clip-mask-right",{position:"absolute",left:"50%",right:0,top:"50%",bottom:"50%","background-color":a}),this._$mask_top=(0,f.default)(o,"photo-clip-mask-top",{position:"absolute",left:0,right:0,top:0,bottom:"50%","background-color":a}),this._$mask_bottom=(0,f.default)(o,"photo-clip-mask-bottom",{position:"absolute",left:0,right:0,top:"50%",bottom:0,"background-color":a}),this._$clip_frame=(0,f.default)(o,"photo-clip-area",{border:n,position:"absolute",left:"50%",top:"50%"}),this._viewList=(0,g.default)(r.view),this._viewList){var s=[];this._viewList.forEach(function(t,e){var i=t.style,o={};o["background-repeat"]=i["background-repeat"],o["background-position"]=i["background-position"],o["background-size"]=i["background-size"],s[e]=o,(0,y.default)(t,{"background-repeat":"no-repeat","background-position":"center","background-size":"contain"})}),this._viewOriginStyleList=s}}},{key:"_initScroll",value:function(){var t=this;this._iScroll=new r.default(this._$clipLayer,{zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,mouseWheel:!0,disablePointer:!0,disableTouch:!1,disableMouse:!1,wheelAction:"zoom",bounceTime:300}),this._iScroll.on("zoomEnd",function(){t._calcScale(),t._resizeMoveLayer(),t._refreshScroll()})}},{key:"_resetScroll",value:function(){var t=this._iScroll;this._calcScale();var e=t.scale=t.options.startZoom;this._resizeMoveLayer(),this._rotateLayerX=0,this._rotateLayerY=0,this._curAngle=0,E(this._$rotateLayer,this._rotateLayerX+this._moveLayerPaddingLeft,this._rotateLayerY+this._moveLayerPaddingTop,this._curAngle),t.scrollTo(.5*(this._clipWidth-this._moveLayerWidth*e),.5*(this._clipHeight-this._moveLayerHeight*e)),this._refreshScroll()}},{key:"_refreshScroll",value:function(t){t=t||0;var e=this._iScroll,i=e.scale,o=e.options,r=Math.max(o.zoomMin,Math.min(o.zoomMax,i));r!==i&&e.zoom(r,void 0,void 0,t),e.refresh(t)}},{key:"_resizeMoveLayer",value:function(){var t=this._iScroll,e=t.options,i=Math.max(e.zoomMin,Math.min(e.zoomMax,t.scale)),o=this._rotateLayerWidth,r=this._rotateLayerHeight,a=this._clipWidth/i,n=this._clipHeight/i,s=!1;if(a>o){s=!0;var l=a-o;o+=2*l,t.x+=(this._moveLayerPaddingLeft-l)*i,this._moveLayerPaddingLeft=l}else this._moveLayerPaddingLeft=0;if(n>r){s=!0;var u=n-r;r+=2*u,t.y+=(this._moveLayerPaddingTop-u)*i,this._moveLayerPaddingTop=u}else this._moveLayerPaddingTop=0;s&&(E(this._$rotateLayer,this._rotateLayerX+this._moveLayerPaddingLeft,this._rotateLayerY+this._moveLayerPaddingTop,this._curAngle),t.scrollTo(t.x,t.y)),this._moveLayerWidth===o&&this._moveLayerHeight===r||(this._moveLayerWidth=o,this._moveLayerHeight=r,(0,y.default)(this._$moveLayer,{width:o,height:r}),this._$clipLayer.appendChild(this._$moveLayer))}},{key:"_calcScale",value:function(){var t=this._iScroll.options,e=this._rotateLayerWidth,i=this._rotateLayerHeight,o=this._options.maxZoom;e&&i?(t.zoomMin=Math.min(1,v.getScale(this._clipWidth,this._clipHeight,e,i)),t.zoomMax=o,t.startZoom=Math.min(o,v.getScale(this._containerWidth,this._containerHeight,e,i))):(t.zoomMin=1,t.zoomMax=1,t.startZoom=1)}},{key:"_initRotationEvent",value:function(){var t=this;if(x){this._hammerManager=new o.default.Manager(this._$moveLayer),this._hammerManager.add(new o.default.Rotate);var e,i,r,a=this._options.rotateFree,n=this._iScroll.options.bounceTime;this._hammerManager.on("rotatestart",function(o){t._atRotation||(e=!0,a?(i=(o.rotation-t._curAngle)%360,t._rotateLayerRotateReady(o.center)):i=o.rotation)}),this._hammerManager.on("rotatemove",function(o){e&&(r=o.rotation-i,a&&t._rotateLayerRotate(r))}),this._hammerManager.on("rotateend rotatecancel",function(i){if(e){if(e=!1,!a)return(r%=360)>180?r-=360:r<-180&&(r+=360),void(r>30?t._rotateBy(90,n,i.center):r<-30&&t._rotateBy(-90,n,i.center));var o=r%360;o<0&&(o+=360),o<10?r+=-o:o>80&&o<100?r+=90-o:o>170&&o<190?r+=180-o:o>260&&o<280?r+=270-o:o>350&&(r+=360-o),t._rotateLayerRotateFinish(r,n)}})}else this._$moveLayer.addEventListener("dblclick",this._rotateCW90)}},{key:"_rotateCW90",value:function(t){this._rotateBy(90,this._iScroll.options.bounceTime,{x:t.clientX,y:t.clientY})}},{key:"_rotateBy",value:function(t,e,i){this._rotateTo(this._curAngle+t,e,i)}},{key:"_rotateTo",value:function(t,e,i){this._atRotation||(this._rotateLayerRotateReady(i),this._rotateLayerRotateFinish(t,e))}},{key:"_rotateLayerRotateReady",value:function(t){var e,i=this._iScroll.scale;(e=t?v.globalToLoacl(this._$moveLayer,t.x,t.y):v.loaclToLoacl(this._$moveLayer,this._$clipLayer,.5*this._clipWidth,.5*this._clipHeight)).x/=i,e.y/=i;var o={x:e.x-(this._rotateLayerX+this._moveLayerPaddingLeft),y:e.y-(this._rotateLayerY+this._moveLayerPaddingTop)},r=v.pointRotate(o,-this._curAngle);this._rotateLayerOriginX=r.x,this._rotateLayerOriginY=r.y;var a=this._$rotateLayer.getBoundingClientRect();H(this._$rotateLayer,this._rotateLayerOriginX,this._rotateLayerOriginY);var n=this._$rotateLayer.getBoundingClientRect();this._rotateLayerX+=(a.left-n.left)/i,this._rotateLayerY+=(a.top-n.top)/i,E(this._$rotateLayer,this._rotateLayerX+this._moveLayerPaddingLeft,this._rotateLayerY+this._moveLayerPaddingTop,this._curAngle)}},{key:"_rotateLayerRotate",value:function(t){E(this._$rotateLayer,this._rotateLayerX+this._moveLayerPaddingLeft,this._rotateLayerY+this._moveLayerPaddingTop,t),this._curAngle=t}},{key:"_rotateLayerRotateFinish",value:function(t,e){var i=this;E(this._$rotateLayer,this._rotateLayerX+this._moveLayerPaddingLeft,this._rotateLayerY+this._moveLayerPaddingTop,t);var o=this._iScroll,r=o.scale,a=o.options,n=this._$rotateLayer.getBoundingClientRect();this._rotateLayerWidth=n.width/r,this._rotateLayerHeight=n.height/r,H(this._$rotateLayer,0,0);var s=this._$rotateLayer.getBoundingClientRect();E(this._$rotateLayer,this._rotateLayerX+this._moveLayerPaddingLeft,this._rotateLayerY+this._moveLayerPaddingTop,0);var l=this._$rotateLayer.getBoundingClientRect();this._rotateLayerX=(l.left-s.left)/r,this._rotateLayerY=(l.top-s.top)/r,this._calcScale(),this._resizeMoveLayer();var h=this._$moveLayer.getBoundingClientRect(),c={x:n.left-this._moveLayerPaddingLeft*r-h.left,y:n.top-this._moveLayerPaddingTop*r-h.top};o.scrollTo(o.x+c.x,o.y+c.y),this._refreshScroll(o.options.bounceTime);var f=Math.max(a.zoomMin,Math.min(a.zoomMax,r));if(f!==r&&(c.x=c.x/r*f,c.y=c.y/r*f),o.startX+=c.x,o.startY+=c.y,t!==this._curAngle&&e&&(0,u.default)(e)&&void 0!==$){c={x:(s.left-n.left)/r,y:(s.top-n.top)/r},H(this._$rotateLayer,this._rotateLayerOriginX,this._rotateLayerOriginY);var p=this._rotateLayerX+this._moveLayerPaddingLeft+c.x,_=this._rotateLayerY+this._moveLayerPaddingTop+c.y;E(this._$rotateLayer,p,_,this._curAngle),this._atRotation=!0,function(t,e,i,o,r,a){(0,y.default)(t,k+"transform"),(0,y.default)(t,k+"transition",k+"transform "+r+"ms cubic-bezier(0.1, 0.57, 0.1, 1)"),E(t,e,i,o),setTimeout(function(){(0,y.default)(t,k+"transition",""),a()},r)}(this._$rotateLayer,p,_,t,e,function(){i._atRotation=!1,i._rotateFinishUpdataElem(t)})}else this._rotateFinishUpdataElem(t)}},{key:"_rotateFinishUpdataElem",value:function(t){H(this._$rotateLayer,this._rotateLayerOriginX=0,this._rotateLayerOriginY=0),E(this._$rotateLayer,this._rotateLayerX+this._moveLayerPaddingLeft,this._rotateLayerY+this._moveLayerPaddingTop,this._curAngle=t%360)}},{key:"_initFile",value:function(){var t=this,e=this._options;(this._fileList=(0,g.default)(e.file))&&this._fileList.forEach(function(e){x||(0,m.default)(e,"accept","image/jpeg, image/x-png, image/png, image/gif"),e.addEventListener("change",t._fileOnChangeHandle)})}},{key:"_fileOnChangeHandle",value:function(t){var e=t.target.files;e.length&&this._lrzHandle(e[0])}},{key:"_lrzHandle",value:function(t){var e=this,i=this._options,o=i.errorMsg;if("object"===b(t)&&t.type&&!/image\/\w+/.test(t.type))return i.loadError.call(this,o.imgError),!1;this._imgLoaded=!1,i.loadStart.call(this,t);try{(0,a.default)(t,i.lrzOption).then(function(t){e._clearImg(),e._createImg(t.base64)}).catch(function(t){i.loadError.call(e,o.imgHandleError,t)})}catch(t){throw i.loadError.call(this,o.imgHandleError,t),t}}},{key:"_clearImg",value:function(){this._$img&&(this._$img.onload=null,this._$img.onerror=null,(0,p.default)(this._$img),this._$img=null,this._imgLoaded=!1)}},{key:"_createImg",value:function(t){var e=this,i=this._options,o=i.errorMsg;this._$img=new Image,(0,y.default)(this._$img,{display:"block","user-select":"none","pointer-events":"none"}),this._$img.onload=function(t){var o=t.target;e._imgLoaded=!0,i.loadComplete.call(e,o),e._$rotateLayer.appendChild(o),e._rotateLayerWidth=o.naturalWidth,e._rotateLayerHeight=o.naturalHeight,(0,y.default)(e._$rotateLayer,{width:e._rotateLayerWidth,height:e._rotateLayerHeight}),(0,_.default)([o,e._$moveLayer],e._resetScroll)},this._$img.onerror=function(t){i.loadError.call(e,o.imgLoadError,t)},(0,m.default)(this._$img,"src",t)}},{key:"_clipImg",value:function(){var t=this._options,e=t.errorMsg;if(this._imgLoaded){var i=v.loaclToLoacl(this._$moveLayer,this._$clipLayer),o=this._iScroll.scale,r=this._canvas.getContext("2d"),a=1,n=1;this._outputWidth||this._outputHeight?(this._canvas.width=this._outputWidth,this._canvas.height=this._outputHeight,a=this._outputWidth/this._clipWidth*o,n=this._outputHeight/this._clipHeight*o):(this._canvas.width=this._clipWidth/o,this._canvas.height=this._clipHeight/o),r.clearRect(0,0,this._canvas.width,this._canvas.height),r.fillStyle="image/png"===t.outputType?"transparent":t.style.jpgFillColor,r.fillRect(0,0,this._canvas.width,this._canvas.height),r.save(),r.scale(a,n),r.translate(this._rotateLayerX+this._moveLayerPaddingLeft-i.x/o,this._rotateLayerY+this._moveLayerPaddingTop-i.y/o),r.rotate(this._curAngle*Math.PI/180),r.drawImage(this._$img,0,0),r.restore();try{var s=this._canvas.toDataURL(t.outputType,t.outputQuality);return this._viewList&&this._viewList.forEach(function(t){(0,y.default)(t,"background-image","url(".concat(s,")"))}),t.done.call(this,s),s}catch(i){throw t.fail.call(this,e.clipError),i}}else t.fail.call(this,e.noImg)}},{key:"_resize",value:function(t,e){(0,_.default)(this._$container,function(){this._containerWidth=this._$container.offsetWidth,this._containerHeight=this._$container.offsetHeight},this);var i=this._options.size,o=this._clipWidth,r=this._clipHeight;if((0,u.default)(t)&&(i[0]=t),(0,u.default)(e)&&(i[1]=e),this._widthIsPercent||this._heightIsPercent){var a=i[0]/i[1];this._widthIsPercent&&(this._clipWidth=this._containerWidth/100*parseFloat(this._widthIsPercent),this._heightIsPercent||(this._clipHeight=this._clipWidth/a)),this._heightIsPercent&&(this._clipHeight=this._containerHeight/100*parseFloat(this._heightIsPercent),this._widthIsPercent||(this._clipWidth=this._clipHeight*a))}else this._clipWidth=i[0],this._clipHeight=i[1];var n=this._clipWidth,s=this._clipHeight;if(this._clipSizeRatio=n/s,this._outputWidth&&!this._outputHeight&&(this._outputHeight=this._outputWidth/this._clipSizeRatio),this._outputHeight&&!this._outputWidth&&(this._outputWidth=this._outputHeight*this._clipSizeRatio),(0,y.default)(this._$clipLayer,{width:n,height:s,"margin-left":-n/2,"margin-top":-s/2}),(0,y.default)(this._$mask_left,{"margin-right":n/2,"margin-top":-s/2,"margin-bottom":-s/2}),(0,y.default)(this._$mask_right,{"margin-left":n/2,"margin-top":-s/2,"margin-bottom":-s/2}),(0,y.default)(this._$mask_top,{"margin-bottom":s/2}),(0,y.default)(this._$mask_bottom,{"margin-top":s/2}),(0,y.default)(this._$clip_frame,{width:n,height:s}),(0,y.default)(this._$clip_frame,k+"transform","translate(-50%, -50%)"),n!==o||s!==r){this._calcScale(),this._resizeMoveLayer(),this._refreshScroll();var l=this._iScroll,h=l.scale,c=.5*(n-o)*h,f=.5*(s-r)*h;l.scrollBy(c,f)}}},{key:"size",value:function(t,e){return this._resize(t,e),this}},{key:"load",value:function(t){return this._lrzHandle(t),this}},{key:"clear",value:function(){return this._clearImg(),this._resetScroll(),this._fileList&&this._fileList.forEach(function(t){t.value=""}),this}},{key:"rotate",value:function(t,e){return void 0===t?this._curAngle:(this._rotateTo(t,e),this)}},{key:"scale",value:function(t,e){return void 0===t?this._iScroll.scale:(this._iScroll.zoom(t,void 0,void 0,e),this)}},{key:"clip",value:function(){return this._clipImg()}},{key:"destroy",value:function(){var t=this;window.removeEventListener("resize",this._resize),this._$container.removeChild(this._$clipLayer),this._$container.removeChild(this._$mask),(0,y.default)(this._$container,this._containerOriginStyle),this._iScroll&&this._iScroll.destroy(),this._hammerManager?(this._hammerManager.off("rotatemove"),this._hammerManager.off("rotateend"),this._hammerManager.destroy()):this._$moveLayer.removeEventListener("dblclick",this._rotateCW90),this._$img&&(this._$img.onload=null,this._$img.onerror=null),this._viewList&&this._viewList.forEach(function(e,i){(0,y.default)(e,t._viewOriginStyleList[i])}),this._fileList&&this._fileList.forEach(function(e){e.removeEventListener("change",t._fileOnChangeHandle),e.value=null}),this._okList&&this._okList.forEach(function(e){e.removeEventListener("click",t._clipImg)}),(0,s.default)(this)}}])&&S(e.prototype,i),d&&S(e,d),t}();function H(t,e,i){e=(e||0).toFixed(2),i=(i||0).toFixed(2),(0,y.default)(t,k+"transform-origin",e+"px "+i+"px")}function E(t,e,i,o){e=e.toFixed(2),i=i.toFixed(2),o=o.toFixed(2),(0,y.default)(t,k+"transform","translateZ(0) translate("+e+"px,"+i+"px) rotate("+o+"deg)")}i.default=M,t.exports=e.default})?o.apply(e,r):o)||(t.exports=a)},function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e){t.exports=i},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];i.forEach(function(e){t[e]=t[e].bind(t)})}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t){Object.getOwnPropertyNames(t).forEach(function(e){delete t[e]}),t.__proto__=Object.prototype}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";var e=i(0),o=i(1),r=i(11),a=i(12),n=i(13);t.exports=function t(){var i,s,l,u,h,c=arguments[0]||{},f=(Object.prototype.toString,1),p=arguments.length,_=!1;for(r(c)&&(_=c,c=arguments[f]||{},f++),o(c)||a(c)||(c={}),f===p&&(c=this,f--);f<p;f++)if(null!=(i=arguments[f]))for(s in i)l=c[s],c!==(u=i[s])&&(_&&u&&((h=e(u))||n(u))?(h?(h=!1,l=l&&e(l)?l:[]):l=l&&n(l)?l:{},c[s]=t(_,l,u)):void 0!==u&&(c[s]=u));return c}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t){return"boolean"==typeof t}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t){return"function"==typeof t}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t){return"[object Object]"===Object.prototype.toString.call(t)}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t){return/%$/.test(t+"")}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t.exports=function(t,i,o,r){var a=document.createElement("DIV");if("object"===e(i)&&(r=i,i=null),"object"===e(o)&&(r=o,o=null),"object"===e(r))for(var n in r)a.style[n]=r[n];return i&&(a.className=i),o&&(a.id=o),t.appendChild(a),a}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t){t.parentNode&&t.parentNode.removeChild(t)}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t,e){var i=e?t:"",o=document.documentElement;if(t in o.style)return i;for(var r,a=t.charAt(0).toUpperCase()+t.substr(1),n=["Webkit","Moz","ms","O"],s=0;r=n[s++];)if(r+a in o.style)return"-"+r.toLowerCase()+"-"+i;return i}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";var e=i(1),o=i(2),r={animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0};t.exports=function(t,i,a){if(e(i)){for(var n in i)a=i[n],o(a)&&!r[i]&&(a+="px"),t.style[n]=a;return t}return void 0===a?window.getComputedStyle(t)[i]:(o(a)&&!r[i]&&(a+="px"),t.style[i]=a,t)}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t.exports=function(t,i,o){if("object"===e(i)){for(var r in i)t[r]=i[r];return t}return void 0===o?t[i]:(t[i]=o,t)}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=i(21);t.exports=function(t,i){return t instanceof HTMLElement?[t]:"object"===e(t)&&t.length?o(t):t&&"string"==typeof t?("string"==typeof i&&(i=document.querySelector(i)),i instanceof HTMLElement||(i=document),o(i.querySelectorAll(t))):[]}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){"use strict";t.exports=function(t){return Array.prototype.map.call(t,function(t){return t})}})?o.apply(e,r):o)||(t.exports=a)},function(t,e,i){var o,r,a;r=[e,i(3)],void 0===(a="function"==typeof(o=function(t,e){"use strict";function i(t){return t/180*Math.PI}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.getScale=function(t,e,i,o){var r=t/i,a=e/o;return r>a?r:a},t.pointRotate=function(t,e){var o=i(e),r=Math.sin(o),a=Math.cos(o);return{x:a*t.x-r*t.y,y:a*t.y+r*t.x}},t.angleToRadian=i,t.loaclToLoacl=function(t,i,o,r){var a,n;return o=o||0,r=r||0,(0,e.default)([t,i],function(){a=t.getBoundingClientRect(),n=i.getBoundingClientRect()}),{x:n.left-a.left+o,y:n.top-a.top+r}},t.globalToLoacl=function(t,i,o){var r;return i=i||0,o=o||0,(0,e.default)(t,function(){r=t.getBoundingClientRect()}),{x:i-r.left,y:o-r.top}},e=(o=e)&&o.__esModule?o:{default:o}})?o.apply(e,r):o)||(t.exports=a)}])});